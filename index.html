<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="48x48" href="./favicon.png">
  <title>Livy Tech</title>
  <style>
    @font-face {
      font-family: "RubikMonoOne";
      src: url("./RubikMonoOne_400Regular.ttf") format("truetype");
      font-display: swap;
    }

    :root {
      color-scheme: light;
      --primary: #e8762c;
      --primary-strong: #c8601f;
      --text: #2b2b2b;
      --text-muted: #5a5a5a;
      --surface: rgba(255, 250, 244, 0.94);
      --surface-border: #f5d5b2;
      --field-bg: #fff6ea;
      --field-border: #f8e6d1;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      padding: clamp(18px, 4vw, 44px);
      font-family: "Avenir Next", "Segoe UI", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 8% -5%, #ffe7cb 0%, transparent 45%),
        radial-gradient(circle at 92% 12%, #ffd8b0 0%, transparent 40%),
        linear-gradient(155deg, #fff8f1 0%, #ffefd9 100%);
    }

    body::before,
    body::after {
      content: "";
      position: fixed;
      border-radius: 999px;
      pointer-events: none;
      z-index: -1;
    }

    body::before {
      width: min(52vw, 480px);
      height: min(52vw, 480px);
      right: -140px;
      top: min(46vh, 320px);
      background: radial-gradient(circle, rgba(232, 118, 44, 0.2), rgba(232, 118, 44, 0));
    }

    body::after {
      width: min(42vw, 340px);
      height: min(42vw, 340px);
      left: -120px;
      top: min(52vh, 420px);
      background: radial-gradient(circle, rgba(255, 204, 153, 0.28), rgba(255, 204, 153, 0));
    }

    .container {
      width: min(640px, 100%);
      margin: 0 auto;
      padding: clamp(20px, 4vw, 34px);
      background: var(--surface);
      border: 1px solid var(--surface-border);
      border-radius: 26px;
      box-shadow: 0 20px 48px rgba(148, 78, 29, 0.13);
      backdrop-filter: blur(3px);
    }

    .corner-logo {
      position: fixed;
      top: clamp(10px, 2.2vw, 20px);
      left: clamp(10px, 2.2vw, 20px);
      width: clamp(70px, 10vw, 120px);
      height: auto;
      z-index: 2;
      pointer-events: none;
      filter: drop-shadow(0 6px 16px rgba(120, 70, 30, 0.15));
    }

    .brand-logo {
      margin: 4px 0 10px;
      font-family: "RubikMonoOne", "Rubik Mono One", sans-serif;
      font-size: clamp(30px, 8vw, 42px);
      letter-spacing: 0.6px;
      line-height: 1.08;
      text-align: center;
      color: var(--primary);
      text-shadow: 0 2px 0 rgba(255, 255, 255, 0.72);
    }

    h1 {
      margin: 0 0 10px;
      font-size: clamp(22px, 5vw, 27px);
      text-align: center;
    }

    p {
      margin: 0 0 20px;
      text-align: center;
      color: var(--text-muted);
      font-size: 15px;
    }

    form {
      margin-top: 6px;
    }

    input[type="email"],
    textarea {
      width: 100%;
      min-height: 140px;
      padding: 12px 14px;
      border: 1px solid var(--field-border);
      background: var(--field-bg);
      border-radius: 16px;
      font-size: 15px;
      font-family: inherit;
      color: var(--text);
      resize: vertical;
      transition: border-color 0.18s ease, box-shadow 0.18s ease;
    }

    input[type="email"]:focus,
    textarea:focus {
      border-color: #f1bb8e;
      box-shadow: 0 0 0 3px rgba(232, 118, 44, 0.16);
      outline: none;
    }

    input[type="email"] {
      min-height: 0;
      height: 44px;
      margin-bottom: 12px;
    }

    button {
      margin-top: 12px;
      width: 100%;
      padding: 12px 16px;
      border: 0;
      border-radius: 999px;
      background: linear-gradient(140deg, var(--primary) 0%, var(--primary-strong) 100%);
      color: #ffffff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(200, 96, 31, 0.26);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button:hover:enabled {
      transform: translateY(-1px);
      box-shadow: 0 14px 26px rgba(200, 96, 31, 0.32);
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .status {
      margin-top: 12px;
      font-size: 14px;
      min-height: 20px;
      text-align: center;
    }

    .status.success {
      color: #047857;
    }

    .status.error {
      color: #b91c1c;
    }
  </style>
</head>
<body>
  <img class="corner-logo" src="./livy-logo-tp.png" alt="Livy logo">
  <main class="container">
    <div class="brand-logo">Nuggets</div>
    <h1>Contact Support</h1>
    <p>Write your message below and submit it.</p>

    <form id="supportForm">
      <input
        id="senderEmail"
        name="senderEmail"
        type="email"
        placeholder="Your email address"
        maxlength="320"
        required
      >
      <textarea
        id="message"
        name="message"
        placeholder="Type your support message..."
        maxlength="2000"
        required
      ></textarea>
      <br>
      <button id="submitButton" type="submit">Submit</button>
      <div id="status" class="status" aria-live="polite"></div>
    </form>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/axios@1.12.2/dist/axios.min.js"></script>
  <script>
    window.SUPPORT_API_BASE_URL = 'https://langy-api-20tk.onrender.com';
  </script>
  <script src="./supportService.js"></script>
  <script>
    const form = document.getElementById('supportForm');
    const senderEmailInput = document.getElementById('senderEmail');
    const messageInput = document.getElementById('message');
    const statusEl = document.getElementById('status');
    const submitButton = document.getElementById('submitButton');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    const setStatus = (text, type) => {
      statusEl.textContent = text;
      statusEl.className = type ? 'status ' + type : 'status';
    };

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const senderEmail = senderEmailInput.value.trim().toLowerCase();
      if (!senderEmail) {
        setStatus('Email is required.', 'error');
        return;
      }
      if (!emailRegex.test(senderEmail)) {
        setStatus('Please enter a valid email address.', 'error');
        return;
      }

      const message = messageInput.value.trim();
      if (!message) {
        setStatus('Message is required.', 'error');
        return;
      }

      submitButton.disabled = true;
      setStatus('Sending...', '');

      try {
        await window.supportService.createSupportMessage({
          senderEmail,
          message,
          source: 'happynuggetshome',
        });

        senderEmailInput.value = '';
        messageInput.value = '';
        setStatus('Message sent successfully.', 'success');
      } catch (error) {
        const apiError = error?.response?.data?.error;
        setStatus(apiError || 'Failed to send message.', 'error');
      } finally {
        submitButton.disabled = false;
      }
    });
  </script>
</body>
</html>
